{"remainingRequest":"F:\\cjq\\my-music\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\cjq\\my-music\\src\\base\\suggest\\suggest.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\cjq\\my-music\\src\\base\\suggest\\suggest.vue","mtime":1604843353318},{"path":"F:\\cjq\\my-music\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\cjq\\my-music\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQge3NlYXJjaFF1ZXJ5fSBmcm9tICdhcGkvc2VhcmNoJw0KaW1wb3J0IHtjcmVhdGVTb25nLHByb2Nlc3NTb25nc1VybH0gZnJvbSAnY29tbW9uL2pzL3NvbmcnDQppbXBvcnQge0VSUl9PS30gZnJvbSAnYXBpL2NvbmZpZycNCmltcG9ydCBTY3JvbGwgZnJvbSAnYmFzZS9zY3JvbGwvc2Nyb2xsJw0KaW1wb3J0IExvYWRpbmcgZnJvbSAnYmFzZS9sb2FkaW5nL2xvYWRpbmcnDQppbXBvcnQge2RlYm91bmNlfSBmcm9tICdjb21tb24vanMvdXRpbCcNCmltcG9ydCB7IG1hcEFjdGlvbnMsIG1hcE11dGF0aW9ucyB9IGZyb20gJ3Z1ZXgnDQppbXBvcnQgU2luZ2VyIGZyb20gJ2NvbW1vbi9qcy9zaW5nZXInDQoNCg0KY29uc3QgU0lOR0VSPSdzaW5nZXInDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgY29tcG9uZW50czogew0KICAgIFNjcm9sbCwNCiAgICBMb2FkaW5nLA0KICB9LA0KICBwcm9wczogew0KICAgIHBlcnBhZ2U6ew0KICAgICAgICB0eXBlOk51bWJlciwNCiAgICAgICAgZGVmYXVsdDoyMA0KICAgIH0sDQogICAgc2hvd1Npbmdlcjp7DQogICAgICAgIHR5cGU6Qm9vbGVhbiwNCiAgICAgICAgZGVmYXVsdDpmYWxzZQ0KICAgIH0sDQogICAgcXVlcnk6ew0KICAgICAgICB0eXBlOlN0cmluZywNCiAgICAgICAgZGVmYXVsdDonJw0KICAgIH0sDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgICAgcGFnZToxLA0KICAgICAgICBzZWFyY2hMaXN0OltdLA0KICAgICAgICBwdWxsdXA6dHJ1ZSwNCiAgICAgICAgY291bnRwYWdlOk51bWJlcg0KDQogICAgfTsNCiAgfSwNCiAgd2F0Y2g6IHt9LA0KICBjb21wdXRlZDogew0KICAgIGhhc01vcmUoKXsgICAgIA0KICAgICAgcmV0dXJuIHRoaXMucGFnZTw9dGhpcy5jb3VudHBhZ2U/dHJ1ZTpmYWxzZQ0KICAgIH0NCiAgfSwNCiAgdXBkYXRlZCgpew0KICAgIHRoaXMuJHJlZnMuc2Nyb2xsLnJlZnJlc2goKSAgIA0KICB9LA0KICBtZXRob2RzOiB7DQogICAgICBzZWxlY3RJdGVtKGl0ZW0peyAgICANCiAgICAgICAgIGlmKGl0ZW0udHlwZT09PVNJTkdFUil7DQogICAgICAgICAgY29uc3Qgc2luZ2VyID0gbmV3IFNpbmdlcih7DQogICAgICAgICAgICBpZDogaXRlbS5zaW5nZXJtaWQsDQogICAgICAgICAgICBuYW1lOiBpdGVtLnNpbmdlcm5hbWUNCiAgICAgICAgICB9KQ0KICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHtwYXRoOmAvc2luZ2VyLyR7aXRlbS5zaW5nZXJtaWR9YH0pICAgICAgICAgIA0KICAgICAgICAgIHRoaXMuU0VUX1NJTkdFUihzaW5nZXIpICAgDQogICAgICAgICB9ZWxzZXsgICAgICAgICAgDQogICAgICAgICAgdGhpcy4kZW1pdCgnc2VsZWN0JyxpdGVtKQ0KICAgICAgICAgfXRoaXMuc2F2ZXNlYXJjaEhpc3RvcnkodGhpcy5xdWVyeSkgIA0KICAgICAgfSwNCiAgICAgIHNlYXJjaE1vcmUoKXsNCiAgICAgICAgdGhpcy5wYWdlKysNCiAgICAgICAgaWYoIXRoaXMuaGFzTW9yZSl7DQogICAgICAgICAgcmV0dXJuIA0KICAgICAgICB9DQogICAgICAgICBzZWFyY2hRdWVyeSh0aGlzLnF1ZXJ5LHRoaXMucGFnZSx0aGlzLnBlcnBhZ2UsdGhpcy5zaG93U2luZ2VyKS50aGVuKChyZXMpPT57DQogICAgICAgICAgIGlmKHJlcy5jb2RlPT09RVJSX09LKXsNCiAgICAgICAgICAgICB0aGlzLl9nZW5SZXN1bHQocmVzLmRhdGEpLnRoZW4oKHJlc3VsdCkgPT4gew0KICAgICAgICAgICAgICB0aGlzLnNlYXJjaExpc3QucHVzaCguLi5yZXN1bHQpICAgDQogICAgICAgICAgICB9KQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICAgIH0sDQogICAgICAgc2hvd0ljb24oaXRlbSl7DQogICAgICAgICBpZihpdGVtLnR5cGU9PT1TSU5HRVIpew0KICAgICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgICAgfWVsc2V7DQogICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICAgfQ0KICAgICAgIH0sDQogICAgICAgZ2V0TmFtZShpdGVtKXsNCiAgICAgICAgIGlmKGl0ZW0udHlwZT09PVNJTkdFUil7DQogICAgICAgICAgIHJldHVybiBpdGVtLnNpbmdlcm5hbWUNCiAgICAgICAgIH1lbHNlew0KICAgICAgICAgcmV0dXJuIGAke2l0ZW0ubmFtZX0tJHtpdGVtLnNpbmdlcn1gDQogICAgICAgICB9DQogICAgICAgfSwNCiAgICAgICBfc2VhcmNoUXVlcnkoKXsNCiAgICAgICAgc2VhcmNoUXVlcnkodGhpcy5xdWVyeSwgdGhpcy5wYWdlLCB0aGlzLnBlcnBhZ2UsIHRoaXMuc2hvd1NpbmdlcikudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcy5jb2RlID09PSBFUlJfT0spIHsNCiAgICAgICAgICAgIHRoaXMuY291bnRwYWdlPU1hdGguY2VpbChyZXMuZGF0YS5zb25nLnRvdGFsbnVtL3RoaXMucGVycGFnZSkNCiAgICAgICAgICAgICB0aGlzLl9nZW5SZXN1bHQocmVzLmRhdGEpLnRoZW4oKHJlc3VsdCkgPT4gew0KICAgICAgICAgICAgICB0aGlzLnNlYXJjaExpc3QgPXJlc3VsdCANCiAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcy5zZWFyY2hMaXN0KSAgICAgICAgICAgIA0KICAgICAgICAgICAgfSkgICAgICAgICAgICANCiAgICAgICAgICB9DQogICAgICAgIH0pICAgIA0KICAgICAgfSwNCiAgICAgIF9nZW5SZXN1bHQoZGF0YSkgew0KICAgICAgICBsZXQgcmV0ID0gW10NCiAgICAgICAgaWYgKGRhdGEuemhpZGEgJiYgZGF0YS56aGlkYS5zaW5nZXJpZCAmJiB0aGlzLnBhZ2UgPT09IDEpIHsNCiAgICAgICAgICByZXQucHVzaCh7Li4uZGF0YS56aGlkYSwgLi4ue3R5cGU6IFNJTkdFUn19KQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwcm9jZXNzU29uZ3NVcmwodGhpcy5fbm9ybWFsaXplU29uZ3MoZGF0YS5zb25nLmxpc3QpKS50aGVuKChzb25ncykgPT4gew0KICAgICAgICAgIHJldCA9IHJldC5jb25jYXQoc29uZ3MpDQogICAgICAgICAgcmV0dXJuIHJldA0KICAgICAgICB9KQ0KICAgICAgfSwNCiAgICAgIF9ub3JtYWxpemVTb25ncyhsaXN0KSB7DQogICAgICAgIGxldCByZXQgPSBbXQ0KICAgICAgICBsaXN0LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgIHJldC5wdXNoKGNyZWF0ZVNvbmcoaXRlbSkpDQogICAgICAgIH0pDQogICAgICAgIHJldHVybiByZXQNCiAgICAgIH0sDQogICAgICAuLi5tYXBBY3Rpb25zKFsnc2F2ZXNlYXJjaEhpc3RvcnknLCcgaW5zZXJ0U29uZyddKSwNCiAgICAgIC4uLm1hcE11dGF0aW9ucyhbJ1NFVF9TSU5HRVInXSkNCiAgfSwNCiAgY3JlYXRlZCgpIHsNCiAgICAgICB0aGlzLiR3YXRjaCgncXVlcnknLGRlYm91bmNlKChuZXdRdWVyeSk9PnsNCiAgICAgICAgICBpZihuZXdRdWVyeS50cmltKCkubGVuZ3RoPT09MCl7DQogICAgICAgICAgICAgIHJldHVybiANCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy5fc2VhcmNoUXVlcnkoKQ0KICAgICAgICAgIH0sMjAwKSAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICkgICAgICAgICAgICAgICAgICANCiAgfSwNCiAgbW91bnRlZCgpIHsgICANCiAgfQ0KfTsNCg=="},{"version":3,"sources":["suggest.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"suggest.vue","sourceRoot":"src/base/suggest","sourcesContent":["<template>\r\n  <scroll class=\"suggest-list\" \r\n        :pullup=\"pullup\"\r\n        ref=\"scroll\"\r\n        @scrollToEnd=\"searchMore\">\r\n   <ul >\r\n      <li class=\"suggest-item\" \r\n          :key=\"index\" v-for=\"(item,index) in searchList\"\r\n          @click=\"selectItem(item)\">\r\n          <svg-icon v-show=\"showIcon(item)\"  icon-class=\"singer\" class-name=\"icon\"></svg-icon>  \r\n          <svg-icon v-show=\"!showIcon(item)\" icon-class=\"music\" class-name=\"icon\" ></svg-icon>             \r\n        <div class=\"name\">\r\n          <p class=\"text\" v-html=\"getName(item)\"></p>\r\n        </div>\r\n      </li>\r\n      <loading v-show=\"hasMore\" > </loading>\r\n    </ul>     \r\n</scroll>\r\n</template>\r\n\r\n<script>\r\nimport {searchQuery} from 'api/search'\r\nimport {createSong,processSongsUrl} from 'common/js/song'\r\nimport {ERR_OK} from 'api/config'\r\nimport Scroll from 'base/scroll/scroll'\r\nimport Loading from 'base/loading/loading'\r\nimport {debounce} from 'common/js/util'\r\nimport { mapActions, mapMutations } from 'vuex'\r\nimport Singer from 'common/js/singer'\r\n\r\n\r\nconst SINGER='singer'\r\n\r\nexport default {\r\n  components: {\r\n    Scroll,\r\n    Loading,\r\n  },\r\n  props: {\r\n    perpage:{\r\n        type:Number,\r\n        default:20\r\n    },\r\n    showSinger:{\r\n        type:Boolean,\r\n        default:false\r\n    },\r\n    query:{\r\n        type:String,\r\n        default:''\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n        page:1,\r\n        searchList:[],\r\n        pullup:true,\r\n        countpage:Number\r\n\r\n    };\r\n  },\r\n  watch: {},\r\n  computed: {\r\n    hasMore(){     \r\n      return this.page<=this.countpage?true:false\r\n    }\r\n  },\r\n  updated(){\r\n    this.$refs.scroll.refresh()   \r\n  },\r\n  methods: {\r\n      selectItem(item){    \r\n         if(item.type===SINGER){\r\n          const singer = new Singer({\r\n            id: item.singermid,\r\n            name: item.singername\r\n          })\r\n          this.$router.push({path:`/singer/${item.singermid}`})          \r\n          this.SET_SINGER(singer)   \r\n         }else{          \r\n          this.$emit('select',item)\r\n         }this.savesearchHistory(this.query)  \r\n      },\r\n      searchMore(){\r\n        this.page++\r\n        if(!this.hasMore){\r\n          return \r\n        }\r\n         searchQuery(this.query,this.page,this.perpage,this.showSinger).then((res)=>{\r\n           if(res.code===ERR_OK){\r\n             this._genResult(res.data).then((result) => {\r\n              this.searchList.push(...result)   \r\n            })\r\n          }\r\n        })\r\n      },\r\n       showIcon(item){\r\n         if(item.type===SINGER){\r\n           return true\r\n         }else{\r\n           return false\r\n         }\r\n       },\r\n       getName(item){\r\n         if(item.type===SINGER){\r\n           return item.singername\r\n         }else{\r\n         return `${item.name}-${item.singer}`\r\n         }\r\n       },\r\n       _searchQuery(){\r\n        searchQuery(this.query, this.page, this.perpage, this.showSinger).then((res) => {\r\n          if (res.code === ERR_OK) {\r\n            this.countpage=Math.ceil(res.data.song.totalnum/this.perpage)\r\n             this._genResult(res.data).then((result) => {\r\n              this.searchList =result \r\n              console.log(this.searchList)            \r\n            })            \r\n          }\r\n        })    \r\n      },\r\n      _genResult(data) {\r\n        let ret = []\r\n        if (data.zhida && data.zhida.singerid && this.page === 1) {\r\n          ret.push({...data.zhida, ...{type: SINGER}})\r\n        }\r\n        return processSongsUrl(this._normalizeSongs(data.song.list)).then((songs) => {\r\n          ret = ret.concat(songs)\r\n          return ret\r\n        })\r\n      },\r\n      _normalizeSongs(list) {\r\n        let ret = []\r\n        list.forEach((item) => {\r\n            ret.push(createSong(item))\r\n        })\r\n        return ret\r\n      },\r\n      ...mapActions(['savesearchHistory',' insertSong']),\r\n      ...mapMutations(['SET_SINGER'])\r\n  },\r\n  created() {\r\n       this.$watch('query',debounce((newQuery)=>{\r\n          if(newQuery.trim().length===0){\r\n              return \r\n          }\r\n          this._searchQuery()\r\n          },200)                       \r\n        )                  \r\n  },\r\n  mounted() {   \r\n  }\r\n};\r\n</script>\r\n<style scoped >\r\n.suggest-list{\r\n  position: fixed;\r\n  top:100px;\r\n  left:20px;\r\n  right: 20px;\r\n  bottom:0;\r\n  z-index: 100;\r\n  width:334px;\r\n  height: calc(100vh - 100px);\r\n  background-color: #222;\r\n  overflow:hidden;\r\n}\r\n.suggest-item{\r\n  display: flex;\r\n  padding-top:20px;\r\n}\r\n.icon{\r\n  font-size:14px;\r\n  color:dimgrey;\r\n  padding-right:10px;\r\n}\r\n.name{  \r\n  color:#8f8f8f;\r\n}\r\n\r\n</style>\r\n"]}]}